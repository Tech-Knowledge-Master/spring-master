## Spring WEB MVC의 근간에는 Java Servlet 이 있는데요. Spring 은 Servlet을 어떻게 구성해서 이를 구현했을까요?

---

### 서블릿(Servlet)이란?

#### 1) 서블릿의 등장
서블릿이 등장하기 이전에는, 클라이언트의 요청에 따른 동적인 처리를 `CGI`라는 인터페이스가 처리하였다.
하지만 CGI도 메모리와 시간적 측면에서의 문제점을 가지고 있었고
이를 해결하기 위해 다발적으로 생성되던 CGI 구현체를 Singleton Pattern 을 이용하여 단 한개만 생성되도록 변화시킨 것이 `Servlet` 이다.
정확히는 WAS(WEB Application Server)의 등장으로 탄생한 개념이 서블릿이다. 

** WAS는 동적 데이터 처리를 위해 탄생한 서버로
WAS 내의 Web container 에서 Thread 를 생성하고 Servlet 을 실행시켜준다.

#### 2) 어떤 일을 하는가?
클라이언트의 요청을 받아 처리한 후, 그 결과를 다시 클라이언트에게 전송하는 프로그램으로,
주로 HTTP 프로토콜을 사용하여 웹 페이지를 동적으로 생성하는 데 사용된다.

1. 요청 수신
   - 클라이언트로부터 요청이 들어오면, 웹 서버는 이 요청을 Servlet 컨테이너에 전달

2. 요청 처리
   - Servlet 컨테이너는 요청을 받아 해당 Servlet을 메모리에 로드하고, 요청에 맞는 메서드(doGet, doPost 등)를 호출하여 처리

3. 응답 생성
   - Servlet은 요청을 처리한 결과를 응답 객체에 담아 클라이언트에게 전송
   - 이 때, HTML, JSON 등의 형태로 데이터를 구성할 수 있다

4. 응답 전송
   - 생성된 응답은 웹 서버를 통해 클라이언트에게 전송


### Servlet Container(서블릿 컨테이너)
스프링이 서블릿을 쉽게 관리할 수 있도록, 서블릿을 담고 관리해주는 서블릿 컨테이너를 사용
```
   1. 클라이언트에서 URL 호출
   2. 웹서버에서 URL을 확인하여 해당 서블릿으로 요청 전달, 없으면 서블릿 클래스의 init()으로 생성
   3. 서블릿 컨테이너는 요청정보를 HttpServletRequest, HttpServletResponse 두 객체에 저장
   4. 서블릿 클래스의 service()메소드 호출 (HTTP Method에 따라 서블릿의 doGet, doPost 호출)
   5. 요청 처리 후 HttpServletResponse 객체에 HTTP 데이터를 담아 응답
   6. 웹서버가 클라이언트에 응답처리
   7. 서블릿의 destroy() 호출하여 GC에 의해 서블릿 종료
```


### Dispatcher Servlet(디스패처 서블릿)
요청을 수행할때마다 매번 서블릿을 생성하지 않고 하나의 서블릿만을 정의해서 모든 요청을 수행
서블릿 컨테이너 앞에서 최초로 가장 먼저 요청을 받고 처리하기에 Front Controller 라고도 부른다

```
   1. 클라이언트에서 최초 요청을 전달받는다
   2. 요청을 처리할 적절한 핸들러(컨트롤러)에 라우팅 (핸들러 매핑을 통해 요청 URI와 컨트롤러를 매핑)
   3. 적절한 핸들러를 실행시킬 수 있는 Handler Adapter를 통해 선택된 핸들러를 실행
   4. 선택된 핸들러(컨트롤러)는 비즈니스 로직을 수행
   5. 핸들러(컨트롤러)가 비즈니스 로직 실행을 마치면 처리 결과를 Model에 설정하여 HandlerAdapter에 view name을 반환
   6. 전달받은 view name을 뷰 리졸버에 반환하고 view name과 맡는 view객체를 반환
   7. 디스패쳐 서블릿은 view에 model을 전달
   8. 렌더링하여 클라이언트에 반환
```