# Spring DI/IoC는 어떻게 동작하나요?

## 제어의 역전(IoC- Inversion of Control)

메서드나 객체의 호출 작업을 개발자가 결정하는 것이 아니라, 외부에서 결정되는 것을 의미한다.

즉, 객체를 필요할 때 생성해서 사용하는 것이 아닌 미리 생성해 놓고 꺼내어 사용하는 방식

IoC 는 “제어의 흐름을 바꾼다” 라고도 하며 객체의 의존성을 역전시켜 객체간의 결합도를 줄이고 유연한 코드를 작성할 수 있게 하여 가독성 및 코드 중복, 유지 보수를 편하게 하게 해준다.

스프링에서 IoC는 DI를 통해 구현된다.

## IoC 컨테이너
IoC 컨테이너는 이러한 IoC를 구현하는 주체이며 애플리케이션의 객체를 생성하고 이들 간의 의존성을 관리하는 역할을 한다.

> (1) 기존에는 객체 생성 → 의존성 객체 생성(클래스 내부에서 생성) → 의존성 객체 메서드 호출의 과정으로 객체가 만들어지고 실행되었다면,
>
> (2) 스프링에서는 객체 생성 → 의존성 객체 주입 → 의존성 객체 메서드 호출의 형식으로 객체가 만들어지고 실행된다.


스프링이 모든 의존성 객체를 스프링이 실행될 때 다 만들어주고 필요한 곳에 주입시킴으로써

Bean 들은 싱글턴 패턴의 특징을 지니며, 제어의 흐름을 개발자가 아닌 스프링에게 맡겨 작업을 처리하게 된다.

> @Configuration 어노테이션을 통해 싱글톤으로 빈들이 관리된다.

## 의존성 주입(DI- Dependency Injection)
* 스프링은 객체의 의존성을 의존성 주입을 통해 관리한다.
객체를 직접 생성하는 것이 아니라 외부에서 생성한 후 주입시켜주는 방식이다.

* DI 를 통해 모듈 간의 결합도가 낮아지고 유연성이 높아진다.

* 재사용성이 높아지고 테스트의 용이성이 향상된다.

  - 클래스가 인터페이스를 기반으로 호출하게 함
  - 의존성 주입을 통해 객체 생성을 추상화

* 생성자를 통한 의존성 주입(DI)이 권장됨 → 한번 의존성을 주입 받은 객체는 프로그램이 끝날 때까지 변하지 않는 특징을 가지므로 불변성을 표시해주는 것이 좋기 때문

* A객체에서 객체 B,C를 사용하려면 아래의 두가지 방식이 존재한다.

  1. A객체 내부에서 B,C 객체를 new 생성자를 통해 직접 생성 (강한 결합)
  2. 외부에서 생성된 객체를 주입을 통해 사용하는 방법(약한 결합)

즉, 외부(IoC)에서 생성된 B,C 객체를 주입 시켜 setter, 필드, 생성자를 통해 사용하는 방식
스프링에서는 이러한 객체를 Bean 이라 부르며

프로젝트가 실행될 때 사용자가 빈으로 관리하는 객체들의 생성과 소멸에 관련된 작업을 자동적으로 수행해주는데 객체가 생성되는 곳을 스프링에서는 스프링 컨테이너(IoC 컨테이너, DI 컨테이너) 라 부른다.


## 의존 관계 자동 주입
### 생성자 주입 Vs 수정자 주입, 필드주입

- 생성자 주입은 빈 객체를 생성하는 시점에 생성자의 파라미터 빈 객체를 찾아서 먼저 주입한 뒤에 주입받은 빈 객체를 이용하게 된다.(주입 → 생성) - 런타임 시점이 아닌 애플리케이션 구동 시점에 순환 참조 오류 발견 가능
- 수정주입, 필드주입은 빈을 먼저 생성한 후에 어노테이션이 붙은 필드에 해당하는 빈으르 찾아서 주입하는 방식 - 빈을 먼저 생성한 후에 필드에 주입하기 때문에 빈 객체 생성한 시점에는 순환 참조 발생 여부 확인 불가능(생성 → 주입)


### 롬복 - @RequiredArgsConstructor

- 롬복에서 지원하는 애노테이션
- 생성자로 의존성 주입 실행
- final 키워드가 붙은 필드에 대해 생성자를 자동으로 생성해줌
* 장점

  1. final 키워드가 붙은 주입에만 생성자를 만들어주기에 인스턴스가 생성될 때 1번만 참조되므로 코드 변이의 걱정이 사라진다.
  2. 생성자 어노테이션을 사용할 경우 순환 참조가 일어날 경우 Exception 이 발생해 컴파일 중에 에러가 발생한다. 이를 통해 Test 단계에서 순환 참조를 파악해 수정이 가능하다.

## 정리
1. @Autowired 는 필요한 의존 객체의 “타입"에 해당하는 빈을 찾아 주입한다.
2. @Component가 붙은 대상은 자동으로 스프링 컨테이너에 등록된다
3. 이외에도 @Controller, @Service, @Repository, @Configuration도 등록 대상이 된다.
4. @Controller은 스프링 MVC 컨트롤러로 인식되며
5. @Repository는 스프링 데이터 접근 계층으로 인식하고 해당 계층에서 발생하는 예외는 모두DataAccessException으로 변환한다.
6. @Configuration은 스프링 설정 정보로 인식하고 스프링 빈이 싱글톤을 유지하도록 추가 처리
7. 마지막으로 @Service는 특별한 처리는 하지 않으나, 개발자들이 핵심 비즈니스 계층을 인식하는데 도움을 준다.
